@using System.Diagnostics.CodeAnalysis
@using BlazorHiPrint.Client.Data
@using BootstrapBlazor.Components
<div style="@Style" draggable="true" @onclick="@OnClick" @ondragstart="@HandleDragStart" >

    @if (selectedType != null)
    {
        <DynamicComponent Type="selectedType" Parameters="parameter" />

    }else
    {

        <div>NULL</div>
    }
</div>
@code {
    [NotNull]
    [Parameter]
    public MTmpltBase? Temp { get; set; }
    [Parameter]
    public Action<MTmpltBase>? OnClicked { get; set; }
    Dictionary<string, object>? parameter;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        parameter = new Dictionary<string, object>()
        {
            { "Value", Temp }
        };
        Temp.FiledHasChanged +=  (_, _) => StateHasChanged();
    }
    string Style
    {
        get
        {

            //直接使用字符串连接
            return $@"  position: absolute;
            top: {Temp.Top}px;
            left: {Temp.Left}px;";
        }

    }

    private Type? selectedType => PrintElementsFactory.GetPrintElementType(Temp);


    private void OnClick()
    {

        if(OnClicked != null)
        {
            OnClicked(Temp);
        }
    }
    private void HandleDragStart(DragEventArgs args)
    {
        args.DataTransfer.DropEffect = "move";
        args.DataTransfer.EffectAllowed = "move";
        if (OnClicked != null)
        {
            OnClicked(Temp);
        }
    }
}
